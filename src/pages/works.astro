---
import { getCollection } from "astro:content";

// å–å¾—å…¨éƒ¨ list
const illustratorsRaw = await getCollection("illustrators");

// S = æƒ³è¦å§”è¨—
const wishlist = illustratorsRaw
    .filter((x) => x.data.priority === "S")
    .sort((a, b) => (a.data.order ?? 9999) - (b.data.order ?? 9999));

// A = å·²å§”è¨—
const commissioned = illustratorsRaw
    .filter((x) => x.data.priority === "A")
    .sort((a, b) => (a.data.order ?? 9999) - (b.data.order ?? 9999));
---
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <title>ç¹ªå¸«æ”¶è—</title>

    <!-- å­—é«”ï¼šNoto Sans JP -->
    <link
            href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap"
            rel="stylesheet"
    />

    <style>
        body {
            font-family: "Noto Sans JP", sans-serif;
            background: #f6f7f9;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem 4rem;
        }

        /* ğŸ”¹ é é¦–æ’ç‰ˆï¼šå·¦é‚Šæ¨™é¡Œ + å³ä¸Šæœå°‹æ¡† */
        .page-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .title-block h1 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0 0 0.5rem;
        }

        .title-block p {
            margin: 0;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        @media (max-width: 720px) {
            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 1rem;
            }
        }

        h2.section-title {
            margin: 3rem 0 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* ğŸ” æœå°‹æ¬„ï¼šå³ä¸Šè§’ã€å¤§é¡†è† å›Š + è—è‰²é‡é» */
        .search-box {
            position: relative;
            min-width: 260px;
            max-width: 360px;
            flex-shrink: 0;
        }

        .search-box-inner {
            position: relative;
            border-radius: 999px;
            padding: 2px; /* å¤–åœˆæ¼¸å±¤æ¡† */
            background: linear-gradient(135deg, #0096fa, #80c2ff);
            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.18);
        }

        .search-input-wrapper {
            display: flex;
            align-items: center;
            border-radius: 999px;
            background: #ffffff;
            padding: 0.25rem 0.3rem 0.25rem 0.9rem;
        }

        .search-icon {
            font-size: 1rem;
            opacity: 0.7;
            margin-right: 0.45rem;
        }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 0.95rem;
            padding: 0.65rem 0.2rem;
            min-width: 0;
        }

        .search-box input::placeholder {
            color: #9ca3af;
        }

        .search-badge {
            font-size: 0.75rem;
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
            background: #eff6ff;
            color: #1d4ed8;
            border: 1px solid rgba(129, 140, 248, 0.55);
            margin-left: 0.4rem;
            white-space: nowrap;
        }

        @media (max-width: 720px) {
            .search-box {
                width: 100%;
                max-width: none;
            }
        }

        /* é–‹é—œæŒ‰éˆ• */
        .toggle-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            margin-bottom: 1rem;
            padding: 0.35rem 0.9rem;
            background: #0096fa;
            color: white;
            border-radius: 0.45rem;
            text-decoration: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            border: none;
        }

        /* æŠ˜ç–Šå‹•ç•« */
        .collapsible {
            max-height: 2000px;
            overflow: hidden;
            opacity: 1;
            transform: translateY(0);
            transition:
                    max-height 0.35s ease,
                    opacity 0.25s ease,
                    transform 0.25s ease;
        }

        .collapsible.is-closed {
            max-height: 0;
            opacity: 0;
            transform: translateY(-4px);
        }

        /* åœ–ç£šç‰† */
        .gallery {
            column-count: 3;
            column-gap: 1.2rem;
        }

        @media (min-width: 1024px) {
            .gallery {
                column-count: 4;
            }
        }

        @media (max-width: 640px) {
            .gallery {
                column-count: 2;
            }
        }

        .card {
            display: block;
            margin-bottom: 1.2rem;
            break-inside: avoid;
            text-decoration: none;
            color: inherit;
            border-radius: 1rem;
            overflow: hidden;
            background: #fff;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            transition: 0.15s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        .card picture img {
            width: 100%;
            height: auto;
            display: block;
        }

        .info {
            padding: 0.75rem 0.75rem 1rem;
        }

        .info h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        .status {
            font-size: 0.85rem;
            opacity: 0.7;
            margin: 0.25rem 0;
        }
    </style>

    <!-- JS æŠ˜ç–Š + localStorage + æœå°‹ -->
    <script is:inline>
        function toggleSection(sectionId, btnId, storageKey, labelShow, labelHide) {
            const section = document.getElementById(sectionId);
            const btn = document.getElementById(btnId);
            const isClosed = section.classList.contains("is-closed");

            if (isClosed) {
                section.classList.remove("is-closed");
                btn.textContent = "â–² " + labelHide;
                try { localStorage.setItem(storageKey, "open"); } catch {}
            } else {
                section.classList.add("is-closed");
                btn.textContent = "â–¼ " + labelShow;
                try { localStorage.setItem(storageKey, "closed"); } catch {}
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const states = {
                wishlist: localStorage.getItem("section-wishlist") || "open",
                commissioned: localStorage.getItem("section-commissioned") || "open"
            };

            function applyState(name, labelShow, labelHide) {
                const section = document.getElementById(name + "-section");
                const btn = document.getElementById(name + "-btn");
                const state = states[name];

                if (state === "closed") {
                    section.classList.add("is-closed");
                    btn.textContent = "â–¼ " + labelShow;
                } else {
                    section.classList.remove("is-closed");
                    btn.textContent = "â–² " + labelHide;
                }
            }

            applyState("wishlist", "é¡¯ç¤ºæƒ³è¦å§”è¨—çš„ç¹ªå¸«", "éš±è—æƒ³è¦å§”è¨—çš„ç¹ªå¸«");
            applyState("commissioned", "é¡¯ç¤ºå·²ç¶“å§”è¨—éçš„ç¹ªå¸«", "éš±è—å·²ç¶“å§”è¨—éçš„ç¹ªå¸«");

            // ğŸ” æœå°‹åŠŸèƒ½
            const searchInput = document.getElementById("search-input");
            const cards = Array.from(document.querySelectorAll(".card"));

            function applySearch() {
                const keyword = (searchInput.value || "").trim().toLowerCase();

                cards.forEach((card) => {
                    const name = (card.dataset.name || "").toLowerCase();
                    const show = !keyword || name.includes(keyword);
                    card.style.display = show ? "" : "none";
                });
            }

            if (searchInput) {
                searchInput.addEventListener("input", applySearch);
            }
        });
    </script>
</head>

<body>
<main>
    <div class="page-header">
        <div class="title-block">
            <h1>Phantom éŒ¢éƒ½è·‘å»å“ªçš„å§”è¨—æƒ…å ±</h1>
            <p>
                åˆ†æˆã€Œæƒ³è¦å§”è¨—ã€èˆ‡ã€Œå·²ç¶“å§”è¨—ã€å…©å€å¡Šã€‚<br />
                é»æ“Šç¸®åœ–å¯å‰å¾€åœ–æºã€‚
            </p>
        </div>

        <!-- ğŸ” å³ä¸Šè§’æœå°‹æ¡† -->
        <div class="search-box">
            <div class="search-box-inner">
                <div class="search-input-wrapper">
                    <span class="search-icon">ğŸ”</span>
                    <input
                            id="search-input"
                            type="search"
                            placeholder="æœå°‹ç¹ªå¸«åç¨±â€¦"
                            autocomplete="off"
                    />
                    <span class="search-badge">ç¯©é¸ç¹ªå¸«åç¨±</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”µ Sï¼šæƒ³è¦å§”è¨— -->
    <h2 class="section-title">æƒ³è¦å§”è¨—çš„ç¹ªå¸«</h2>

    <button
            id="wishlist-btn"
            class="toggle-btn"
            type="button"
            onclick="toggleSection('wishlist-section','wishlist-btn','section-wishlist','é¡¯ç¤ºæƒ³è¦å§”è¨—çš„ç¹ªå¸«','éš±è—æƒ³è¦å§”è¨—çš„ç¹ªå¸«')"
    >
        â–² éš±è—æƒ³è¦å§”è¨—çš„ç¹ªå¸«
    </button>

    <div id="wishlist-section" class="collapsible">
        <div class="gallery">
            {wishlist.map((item) => (
                    <a
                            href={`./${item.slug}/`}
                            class="card"
                            data-name={item.data.name.toLowerCase()}
                    >
                        <picture>
                            <img src={item.data.avatar.src} alt={item.data.name} loading="lazy" />
                        </picture>
                        <div class="info">
                            <h3>{item.data.name}</h3>
                            <p class="status">æƒ³å§”è¨—</p>
                        </div>
                    </a>
            ))}
        </div>
    </div>

    <!-- ğŸŸ© Aï¼šå·²ç¶“å§”è¨— -->
    <h2 class="section-title">å·²ç¶“å§”è¨—éçš„ç¹ªå¸«</h2>

    <button
            id="commissioned-btn"
            class="toggle-btn"
            type="button"
            onclick="toggleSection('commissioned-section','commissioned-btn','section-commissioned','é¡¯ç¤ºå·²ç¶“å§”è¨—éçš„ç¹ªå¸«','éš±è—å·²ç¶“å§”è¨—éçš„ç¹ªå¸«')"
    >
        â–² éš±è—å·²ç¶“å§”è¨—éçš„ç¹ªå¸«
    </button>

    <div id="commissioned-section" class="collapsible">
        <div class="gallery">
            {commissioned.map((item) => (
                    <a
                            href={`./${item.slug}/`}
                            class="card"
                            data-name={item.data.name.toLowerCase()}
                    >
                        <picture>
                            <img src={item.data.avatar.src} alt={item.data.name} loading="lazy" />
                        </picture>
                        <div class="info">
                            <h3>{item.data.name}</h3>
                            <p class="status">å·²å§”è¨—</p>
                        </div>
                    </a>
            ))}
        </div>
    </div>

</main>
</body>
</html>
