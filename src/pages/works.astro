---
import { getCollection } from "astro:content";

// å–å¾—å…¨éƒ¨ list
const illustratorsRaw = await getCollection("illustrators");

// S = æƒ³è¦å§”è¨—
const wishlist = illustratorsRaw
    .filter((x) => x.data.priority === "S")
    .sort((a, b) => (a.data.order ?? 9999) - (b.data.order ?? 9999));

// A = å·²å§”è¨—
const commissioned = illustratorsRaw
    .filter((x) => x.data.priority === "A")
    .sort((a, b) => (a.data.order ?? 9999) - (b.data.order ?? 9999));
---
<html lang="zh-Hant">
<head>
    <meta charset="utf-8" />
    <title>ç¹ªå¸«æ”¶è—</title>

    <!-- å­—é«”ï¼šNoto Sans JP -->
    <link
            href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap"
            rel="stylesheet"
    />

    <style>
        body {
            font-family: "Noto Sans JP", sans-serif;
            background: #f6f7f9;
        }

        main {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem 1rem 4rem;
        }

        /* ğŸ”¹ é é¦–æ’ç‰ˆï¼šå·¦é‚Šæ¨™é¡Œ + å³ä¸Šæœå°‹æ¡† */
        .page-header {
            display: flex;
            align-items: flex-start;
            justify-content: space-between;
            gap: 1.5rem;
            margin-bottom: 1.5rem;
        }

        .title-block h1 {
            font-size: 2rem;
            font-weight: 700;
            margin: 0 0 0.5rem;
        }

        .title-block p {
            margin: 0;
            font-size: 0.95rem;
            line-height: 1.6;
        }

        @media (max-width: 720px) {
            main {
                padding-top: 1.5rem; /* æ‰‹æ©Ÿç‰ˆä¸Šæ–¹ç¨å¾®æ”¶ç·Š */
            }

            .page-header {
                flex-direction: column;
                align-items: flex-start;
                gap: 0.75rem;
            }
        }

        h2.section-title {
            margin: 3rem 0 0.75rem;
            font-size: 1.5rem;
            font-weight: 700;
        }

        /* ğŸ” æœå°‹æ¬„ï¼šå³ä¸Šè§’ã€å¤§é¡†è† å›Š + è—è‰²é‡é» */
        .search-box {
            position: relative;
            min-width: 260px;
            max-width: 360px;
            flex-shrink: 0;
        }

        .search-box-inner {
            position: relative;
            border-radius: 999px;
            padding: 2px; /* å¤–åœˆæ¼¸å±¤æ¡† */
            background: linear-gradient(135deg, #0096fa, #80c2ff);
            box-shadow: 0 10px 24px rgba(15, 23, 42, 0.18);
        }

        .search-input-wrapper {
            display: flex;
            align-items: center;
            border-radius: 999px;
            background: #ffffff;
            padding: 0.25rem 0.3rem 0.25rem 0.9rem;
        }

        .search-icon {
            font-size: 1rem;
            opacity: 0.7;
            margin-right: 0.45rem;
        }

        .search-box input {
            flex: 1;
            border: none;
            outline: none;
            background: transparent;
            font-size: 0.95rem;
            padding: 0.65rem 0.2rem;
            min-width: 0;
        }

        .search-box input::placeholder {
            color: #9ca3af;
        }

        .search-badge {
            font-size: 0.75rem;
            padding: 0.2rem 0.6rem;
            border-radius: 999px;
            background: #eff6ff;
            color: #1d4ed8;
            border: 1px solid rgba(129, 140, 248, 0.55);
            margin-left: 0.4rem;
            white-space: nowrap;
        }

        @media (max-width: 720px) {
            .search-box {
                width: 100%;
                max-width: none;
            }

            .search-box-inner {
                box-shadow: 0 6px 16px rgba(15, 23, 42, 0.16); /* æ‰‹æ©Ÿç‰ˆé™°å½±ç¨å¾®æ”¶æ–‚ */
            }
        }

        /* é–‹é—œæŒ‰éˆ• */
        .toggle-btn {
            display: inline-flex;
            align-items: center;
            gap: 0.25rem;
            margin-bottom: 1rem;
            padding: 0.35rem 0.9rem;
            background: #0096fa;
            color: white;
            border-radius: 0.45rem;
            text-decoration: none;
            cursor: pointer;
            font-size: 0.9rem;
            font-weight: 600;
            border: none;
        }

        /* æŠ˜ç–Šå‹•ç•« */
        .collapsible {
            max-height: 2000px;
            overflow: hidden;
            opacity: 1;
            transform: translateY(0);
            transition:
                    max-height 0.35s ease,
                    opacity 0.25s ease,
                    transform 0.25s ease;
        }

        .collapsible.is-closed {
            max-height: 0;
            opacity: 0;
            transform: translateY(-4px);
        }

        /* åœ–ç£šç‰† */
        .gallery {
            column-count: 3;
            column-gap: 1.2rem;
        }

        @media (min-width: 1024px) {
            .gallery {
                column-count: 4;
            }
        }

        @media (max-width: 640px) {
            .gallery {
                column-count: 2;
            }
        }

        .card {
            display: block;
            margin-bottom: 1.2rem;
            break-inside: avoid;
            text-decoration: none;
            color: inherit;
            border-radius: 1rem;
            overflow: hidden;
            background: #fff;
            box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
            transition: 0.15s ease;
        }

        .card:hover {
            transform: translateY(-4px);
            box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
        }

        .card picture img {
            width: 100%;
            height: auto;
            display: block;
        }

        .info {
            padding: 0.75rem 0.75rem 1rem;
        }

        .info h3 {
            margin: 0;
            font-size: 1rem;
            font-weight: 600;
        }

        /* ç‹€æ…‹è† å›Šï¼šæƒ³å§”è¨— / å·²å§”è¨— é¡è‰²å€åˆ† */
        .status {
            font-size: 0.8rem;
            display: inline-block;
            padding: 0.12rem 0.6rem;
            border-radius: 999px;
            margin: 0.35rem 0 0;
        }

        .status-want {
            background: #eff6ff;
            color: #1d4ed8;
        }

        .status-done {
            background: #ecfdf3;
            color: #15803d;
        }

        /* æ²’æœ‰çµæœæ™‚çš„å°æç¤ºæ–‡å­— */
        .empty-hint {
            font-size: 0.85rem;
            color: #9ca3af;
            margin-top: 0.5rem;
        }
    </style>

    <!-- JS æŠ˜ç–Š + localStorage + å¤šæ¬„ä½æœå°‹(name+slug+tags) + ç©ºçµæœæç¤º + ARIA -->
    <script is:inline>
        function toggleSection(sectionId, btnId, storageKey, labelShow, labelHide) {
            const section = document.getElementById(sectionId);
            const btn = document.getElementById(btnId);
            const isClosed = section.classList.contains("is-closed");

            if (isClosed) {
                section.classList.remove("is-closed");
                btn.textContent = "â–² " + labelHide;
                btn.setAttribute("aria-expanded", "true");
                try { localStorage.setItem(storageKey, "open"); } catch {}
            } else {
                section.classList.add("is-closed");
                btn.textContent = "â–¼ " + labelShow;
                btn.setAttribute("aria-expanded", "false");
                try { localStorage.setItem(storageKey, "closed"); } catch {}
            }
        }

        document.addEventListener("DOMContentLoaded", () => {
            const states = {
                wishlist: localStorage.getItem("section-wishlist") || "open",
                commissioned: localStorage.getItem("section-commissioned") || "open"
            };

            function applyState(name, labelShow, labelHide) {
                const section = document.getElementById(name + "-section");
                const btn = document.getElementById(name + "-btn");
                const state = states[name];

                if (state === "closed") {
                    section.classList.add("is-closed");
                    btn.textContent = "â–¼ " + labelShow;
                    btn.setAttribute("aria-expanded", "false");
                } else {
                    section.classList.remove("is-closed");
                    btn.textContent = "â–² " + labelHide;
                    btn.setAttribute("aria-expanded", "true");
                }
            }

            applyState("wishlist", "é¡¯ç¤ºæƒ³è¦å§”è¨—çš„ç¹ªå¸«", "éš±è—æƒ³è¦å§”è¨—çš„ç¹ªå¸«");
            applyState("commissioned", "é¡¯ç¤ºå·²ç¶“å§”è¨—éçš„ç¹ªå¸«", "éš±è—å·²ç¶“å§”è¨—éçš„ç¹ªå¸«");

            // ğŸ” å¤šæ¬„ä½æœå°‹åŠŸèƒ½ï¼ˆname + slug + tagsï¼‰
            const searchInput = document.getElementById("search-input");
            const cards = Array.from(document.querySelectorAll(".card"));

            const wishlistSection = document.getElementById("wishlist-section");
            const commissionedSection = document.getElementById("commissioned-section");
            const emptyWishlist = document.querySelector('[data-empty="wishlist"]');
            const emptyCommissioned = document.querySelector('[data-empty="commissioned"]');

            function updateEmptyHint(sectionEl, emptyEl, keyword) {
                if (!sectionEl || !emptyEl) return;
                const sectionCards = Array.from(sectionEl.querySelectorAll(".card"));
                const anyVisible = sectionCards.some((card) => card.style.display !== "none");
                if (keyword && !anyVisible) {
                    emptyEl.style.display = "";
                } else {
                    emptyEl.style.display = "none";
                }
            }

            function applySearch() {
                const keyword = (searchInput.value || "").trim().toLowerCase();

                cards.forEach((card) => {
                    const keywords = (card.dataset.keywords || "").toLowerCase();
                    const show = !keyword || keywords.includes(keyword);
                    card.style.display = show ? "" : "none";
                });

                updateEmptyHint(wishlistSection, emptyWishlist, keyword);
                updateEmptyHint(commissionedSection, emptyCommissioned, keyword);
            }

            if (searchInput) {
                searchInput.addEventListener("input", applySearch);
                applySearch(); // åˆå§‹åŒ–ä¸€æ¬¡ï¼Œç¢ºä¿æç¤ºç‹€æ…‹æ­£ç¢º
            }
        });
    </script>
</head>

<body>
<main>
    <div class="page-header">
        <div class="title-block">
            <h1>Phantom éŒ¢éƒ½è·‘å»å“ªçš„å§”è¨—æƒ…å ±</h1>
            <p>
                åˆ†æˆã€Œæƒ³è¦å§”è¨—ã€èˆ‡ã€Œå·²ç¶“å§”è¨—ã€å…©å€å¡Šã€‚<br />
                é»æ“Šç¸®åœ–å¯å‰å¾€åœ–æºã€‚
            </p>
        </div>

        <!-- ğŸ” å³ä¸Šè§’æœå°‹æ¡† -->
        <div class="search-box">
            <div class="search-box-inner">
                <div class="search-input-wrapper">
                    <span class="search-icon">ğŸ”</span>
                    <input
                            id="search-input"
                            type="search"
                            placeholder="æœå°‹åç¨±ã€slug æˆ–æ¨™ç±¤â€¦"
                            autocomplete="off"
                            aria-label="æœå°‹ç¹ªå¸«åç¨±ã€slug æˆ–æ¨™ç±¤"
                    />
                    <span class="search-badge">å…¨æ¬„ä½æœå°‹</span>
                </div>
            </div>
        </div>
    </div>

    <!-- ğŸ”µ Sï¼šæƒ³è¦å§”è¨— -->
    <h2 class="section-title">æƒ³è¦å§”è¨—çš„ç¹ªå¸«</h2>

    <button
            id="wishlist-btn"
            class="toggle-btn"
            type="button"
            aria-controls="wishlist-section"
            aria-expanded="true"
            onclick="toggleSection('wishlist-section','wishlist-btn','section-wishlist','é¡¯ç¤ºæƒ³è¦å§”è¨—çš„ç¹ªå¸«','éš±è—æƒ³è¦å§”è¨—çš„ç¹ªå¸«')"
    >
        â–² éš±è—æƒ³è¦å§”è¨—çš„ç¹ªå¸«
    </button>

    <div id="wishlist-section" class="collapsible">
        <div class="gallery">
            {wishlist.map((item) => {
                const name = item.data.name ?? item.slug;
                const slug = item.slug;
                const tags = (item.data.tags ?? []).join(" ");
                const keywords = `${name} ${slug} ${tags}`.toLowerCase();

                return (
                        <a
                                href={`./${slug}/`}
                                class="card"
                                data-keywords={keywords}
                        >
                            <picture>
                                <img src={item.data.avatar.src} alt={name} loading="lazy" />
                            </picture>
                            <div class="info">
                                <h3>{name}</h3>
                                {/* æƒ³å§”è¨—ç‹€æ…‹è† å›Š */}
                                <p class="status status-want">æƒ³å§”è¨—</p>
                            </div>
                        </a>
                );
            })}
        </div>

        {/* æƒ³å§”è¨—å€å¡Šçš„ç©ºçµæœæç¤º */}
        <p class="empty-hint" data-empty="wishlist" style="display:none;">
            é€™ä¸€å€ç›®å‰æ²’æœ‰ç¬¦åˆæœå°‹æ¢ä»¶çš„ç¹ªå¸«ï¼Œå¯ä»¥è©¦è©¦æ›å€‹åå­—æˆ–æ¸…é™¤æœå°‹ ğŸ”
        </p>
    </div>

    <!-- ğŸŸ© Aï¼šå·²ç¶“å§”è¨— -->
    <h2 class="section-title">å·²ç¶“å§”è¨—éçš„ç¹ªå¸«</h2>

    <button
            id="commissioned-btn"
            class="toggle-btn"
            type="button"
            aria-controls="commissioned-section"
            aria-expanded="true"
            onclick="toggleSection('commissioned-section','commissioned-btn','section-commissioned','é¡¯ç¤ºå·²ç¶“å§”è¨—éçš„ç¹ªå¸«','éš±è—å·²ç¶“å§”è¨—éçš„ç¹ªå¸«')"
    >
        â–² éš±è—å·²ç¶“å§”è¨—éçš„ç¹ªå¸«
    </button>

    <div id="commissioned-section" class="collapsible">
        <div class="gallery">
            {commissioned.map((item) => {
                const name = item.data.name ?? item.slug;
                const slug = item.slug;
                const tags = (item.data.tags ?? []).join(" ");
                const keywords = `${name} ${slug} ${tags}`.toLowerCase();

                return (
                        <a
                                href={`./${slug}/`}
                                class="card"
                                data-keywords={keywords}
                        >
                            <picture>
                                <img src={item.data.avatar.src} alt={name} loading="lazy" />
                            </picture>
                            <div class="info">
                                <h3>{name}</h3>
                                {/* å·²å§”è¨—ç‹€æ…‹è† å›Š */}
                                <p class="status status-done">å·²å§”è¨—</p>
                            </div>
                        </a>
                );
            })}
        </div>

        {/* å·²å§”è¨—å€å¡Šçš„ç©ºçµæœæç¤º */}
        <p class="empty-hint" data-empty="commissioned" style="display:none;">
            é€™ä¸€å€ç›®å‰æ²’æœ‰ç¬¦åˆæœå°‹æ¢ä»¶çš„ç¹ªå¸«ï¼Œå¯èƒ½æ˜¯åå­—æ‰“éŒ¯äº† ğŸ¥¹
        </p>
    </div>

</main>
</body>
</html>
