---
import { getCollection } from "astro:content";

// ★ 定義優先度權重
const priorityRank = { S: 0, A: 1, B: 2, C: 3 };

// ★ 取得全部 illustrators，並排序後存在 illustrators 變數裡
const illustratorsRaw = await getCollection("illustrators");

const illustrators = illustratorsRaw
  .slice()
  .sort((a, b) => {
    // ① 先比 priority（S → A → B → C）
    const pa = priorityRank[a.data.priority ?? "C"];
    const pb = priorityRank[b.data.priority ?? "C"];
    if (pa !== pb) return pa - pb;

    // ② 再比 order（越小越前）
    const oa = a.data.order ?? 9999;
    const ob = b.data.order ?? 9999;
    if (oa !== ob) return oa - ob;

    // ③ 最後用 name 排序，避免順序亂跳
    return a.data.name.localeCompare(b.data.name, "zh-Hant");
  });
---

<html lang="zh-Hant">
  <head>
  　<link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
    <meta charset="utf-8" />
    <title>繪師收藏</title>
  </head>
  <body>
    <main>
      <h1>Phantom錢都跑去哪的委託情報</h1>
      <p>這裡會顯示我委託過與想委託的繪師。</p>

      <section class="gallery">
        {illustrators.map((item) => (
          <a href={`./${item.slug}/`} class="card">
            <picture>
              <img src={item.data.avatar.src} alt={item.data.name} loading="lazy" />
            </picture>
            <div class="info">
              <h2>{item.data.name}</h2>
              <p class="status">
                {item.data.status === "commissioned" ? "已委託" : "想委託"}
              </p>
              {item.data.tags && (
                <ul class="tags">
                  {item.data.tags.map((tag) => (
                    <li>{tag}</li>
                  ))}
                </ul>
              )}
            </div>
          </a>
        ))}
      </section>
    </main>

    <style>
      body {
        background: #f6f7f9;
      }
      main {
        max-width: 1200px;
        margin: 0 auto;
        padding: 2rem 1rem 4rem;
        font-family: system-ui, -apple-system, BlinkMacSystemFont, "Segoe UI",
          "Noto Sans TC", sans-serif;
        h1 {
          font-family: "Noto Sans JP", sans-serif;
        }
      }
      
      /* --- Masonry layout --- */
      .gallery {
        column-count: 3;
        column-gap: 1.2rem;
      }
      
      @media (min-width: 1024px) {
        .gallery {
          column-count: 4;
        }
      }
      
      .card {
        display: block;
        margin-bottom: 1.2rem;
        break-inside: avoid;
        text-decoration: none;
        color: inherit;
        border-radius: 1rem;
        overflow: hidden;
        background: #fff;
        box-shadow: 0 4px 16px rgba(0, 0, 0, 0.05);
        transition: transform 0.15s ease, box-shadow 0.15s ease;
      }
      
      .card:hover {
        transform: translateY(-4px);
        box-shadow: 0 8px 24px rgba(0, 0, 0, 0.12);
      }
      
      /* --- Images (uniform thumbnails like Eagle) --- */
      .card picture {
        display: block;
        width: 100%;
        /* 不再強制 3:4，也不裁切 */
      }
      
      .card picture img {
        width: 100%;
        height: auto;      /* 讓圖片自己維持比例 */
        display: block;
        /* 不需要 object-fit，保持原比例就好 */
      }

      
      .card:hover picture img {
        transform: scale(1.05);
      }
      
      /* --- Info section --- */
      .info {
        padding: 0.75rem 0.75rem 1rem;
      }
      
      .info h2 {
        margin: 0;
        font-size: 1rem;
        font-weight: 600;
      }
      
      .status {
        font-size: 0.85rem;
        opacity: 0.7;
        margin: 0.25rem 0;
      }
      
      .tags {
        display: flex;
        flex-wrap: wrap;
        gap: 0.35rem;
        margin-top: 0.3rem;
        padding: 0;
        list-style: none;
      }
      
      .tags li {
        font-size: 0.75rem;
        padding: 0.15rem 0.45rem;
        border-radius: 0.75rem;
        border: 1px solid rgba(0, 0, 0, 0.15);
      }
      
    </style>
  </body>
</html>
